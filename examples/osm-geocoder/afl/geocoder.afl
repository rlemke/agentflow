// OSM Geocoder â€” resolve addresses to geographic coordinates
//
// This workflow accepts an address string, dispatches it to the
// Geocode event facet (handled by an external agent), and returns
// the latitude/longitude result.

namespace osm.geo {

    schema GeoCoordinate {
        lat: String
        lon: String
        display_name: String
    }

    event facet Geocode(address: String) => (result: GeoCoordinate)

    workflow GeocodeAddress(address: String) => (location: GeoCoordinate) andThen {
        geo = Geocode(address = $.address)
        yield GeocodeAddress(location = geo.result)
    }

    // Batch geocoding: resolve multiple addresses in parallel
    workflow GeocodeAll(addresses: Json) => (locations: Json) andThen foreach addr in $.addresses {
        geo = Geocode(address = addr.value)
        yield GeocodeAll(locations = geo.result)
    }

}
