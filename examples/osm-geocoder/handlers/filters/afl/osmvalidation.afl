// OSM Cache Validation
//
// Validates OSM cache entries for data quality:
// - Missing required tags (name, type)
// - Invalid or degenerate geometry
// - Coordinates outside valid ranges
// - Duplicate node/way IDs
//
// Produces good/bad statistics and writes invalid entries to output file.

/** OSM data quality validation: tag completeness, geometry, bounds, and duplicates. */
namespace osm.geo.Operations.Validation {
    use osm.types

    /** Validation summary with counts by error category. */
    schema ValidationStats {
        total_entries: Long,
        valid_entries: Long,
        invalid_entries: Long,
        missing_tags: Long,
        invalid_geometry: Long,
        out_of_bounds: Long,
        duplicate_entries: Long,
        validation_date: String
    }

    /** Output file containing invalid entries. */
    schema ValidationResult {
        output_path: String,
        feature_count: Long,
        format: String,
        validation_date: String
    }

    /** Runs all validation checks on a cached OSM dataset. */
    event facet ValidateCache(cache: OSMCache,
        output_dir: String = "/tmp",
        use_hdfs: Boolean = false) => (stats: ValidationStats, result: ValidationResult)

    /** Validates geometry correctness only. */
    event facet ValidateGeometry(cache: OSMCache) => (stats: ValidationStats, result: ValidationResult)

    /** Validates tag completeness against required tags. */
    event facet ValidateTags(cache: OSMCache,
        required_tags: String = "name") => (stats: ValidationStats, result: ValidationResult)

    /** Validates coordinate bounds against a bounding box. */
    event facet ValidateBounds(cache: OSMCache,
        min_lat: Double = -90.0,
        max_lat: Double = 90.0,
        min_lon: Double = -180.0,
        max_lon: Double = 180.0) => (stats: ValidationStats, result: ValidationResult)

    /** Reads a validation result file and computes summary statistics. */
    event facet ValidationSummary(input_path: String) => (stats: ValidationStats)
}
