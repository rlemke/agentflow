{% extends "base.html" %}
{% block title %}Step {{ step.id[:8] if step else "Not Found" }} — AgentFlow{% endblock %}
{% block content %}
{% if not step %}
<h1>Step not found</h1>
{% else %}
<h1>Step <span class="mono">{{ step.id|truncate_uuid }}</span></h1>

<article>
    <table>
        <tr><th>UUID</th><td class="mono">{{ step.id }}</td></tr>
        <tr><th>Workflow</th><td>{% if names.workflow %}<strong>{{ names.workflow }}</strong> — {% endif %}<span class="mono">{{ step.workflow_id }}</span></td></tr>
        <tr><th>Type</th><td>{{ step.object_type }}</td></tr>
        <tr><th>Facet</th><td>{{ step.facet_name or "—" }}</td></tr>
        <tr><th>State</th><td><span class="badge badge-{{ step.state|state_color }}">{{ step.state|state_label }}</span></td></tr>
        <tr><th>Statement</th><td>{% if names.statement %}<strong>{{ names.statement }}</strong> — {% endif %}<span class="mono">{{ step.statement_id or "—" }}</span></td></tr>
        <tr><th>Container</th><td>{% if names.container %}<strong>{{ names.container }}</strong> — {% endif %}<span class="mono">{{ step.container_id or "—" }}</span></td></tr>
        <tr><th>Block</th><td>{% if names.block %}<strong>{{ names.block }}</strong> — {% endif %}<span class="mono">{{ step.block_id or "—" }}</span></td></tr>
    </table>
</article>

{% if step.attributes %}
<div class="grid">
    {% if step.attributes.params %}
    <article>
        <header>Parameters</header>
        <table>
            <thead><tr><th>Name</th><th>Value</th><th>Type</th></tr></thead>
            <tbody>
            {% for name, attr in step.attributes.params.items() %}
            <tr><td>{{ name }}</td><td>{{ attr.value }}</td><td>{{ attr.type_hint }}</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </article>
    {% endif %}

    {% if step.attributes.returns %}
    <article>
        <header>Returns</header>
        <table>
            <thead><tr><th>Name</th><th>Value</th><th>Type</th></tr></thead>
            <tbody>
            {% for name, attr in step.attributes.returns.items() %}
            <tr><td>{{ name }}</td><td>{{ attr.value }}</td><td>{{ attr.type_hint }}</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </article>
    {% endif %}
</div>
{% endif %}

<div class="actions">
    {% if "fail" in step.state.lower() or "error" in step.state.lower() %}
    <button hx-post="/steps/{{ step.id }}/retry"
            hx-confirm="Retry this step? This will reset it to initialization."
            class="outline">Retry</button>
    {% endif %}
</div>

{% endif %}
{% endblock %}
