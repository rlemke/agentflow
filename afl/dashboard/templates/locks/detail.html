{% extends "base.html" %}
{% block title %}Lock {{ lock.key if lock else "Not Found" }} â€” AgentFlow{% endblock %}
{% block content %}
{% if not lock %}
<h1>Lock not found</h1>
<p><a href="/locks">Back to locks</a></p>
{% else %}
<h1>Lock <span class="mono">{{ lock.key }}</span></h1>

<div class="grid">
    <div>
        <article>
            <header>Details</header>
            <table>
                <tr><th>Key</th><td class="mono">{{ lock.key }}</td></tr>
                <tr><th>Acquired At</th><td>{{ lock.acquired_at|timestamp }}</td></tr>
                <tr><th>Expires At</th><td>{{ lock.expires_at|timestamp }}</td></tr>
                <tr>
                    <th>Status</th>
                    <td>
                        {% if lock.expires_at <= now %}
                        <span class="badge badge-error">expired</span>
                        {% else %}
                        <span class="badge badge-success">active</span>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </article>
    </div>
    <div>
        <article>
            <header>Actions</header>
            <div class="actions">
                <button hx-post="/locks/{{ lock.key }}/release"
                        hx-confirm="Release this lock?"
                        class="outline secondary">Release</button>
            </div>
        </article>

        {% if lock.meta %}
        <article>
            <header>Metadata</header>
            <table>
                {% if lock.meta.topic %}<tr><th>Topic</th><td>{{ lock.meta.topic }}</td></tr>{% endif %}
                {% if lock.meta.handler %}<tr><th>Handler</th><td>{{ lock.meta.handler }}</td></tr>{% endif %}
                {% if lock.meta.step_name %}<tr><th>Step Name</th><td>{{ lock.meta.step_name }}</td></tr>{% endif %}
                {% if lock.meta.step_id %}<tr><th>Step ID</th><td class="mono">{{ lock.meta.step_id }}</td></tr>{% endif %}
            </table>
        </article>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
