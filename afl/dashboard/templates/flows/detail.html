{% extends "base.html" %}
{% from "partials/_doc_comment.html" import render_doc %}
{% block title %}Flow {{ flow.name.name if flow else "Not Found" }} â€” AgentFlow{% endblock %}
{% block content %}
{% if not flow %}
<h1>Flow not found</h1>
<p><a href="/flows">Back to flows</a></p>
{% else %}
<h1>{{ flow.name.name }}</h1>

<article>
    <table>
        <tr><th>UUID</th><td class="mono">{{ flow.uuid }}</td></tr>
        <tr><th>Path</th><td class="mono">{{ flow.name.path }}</td></tr>
        <tr><th>Namespaces</th><td>{{ flow.namespaces|length }}</td></tr>
        <tr><th>Facets</th><td>{{ flow.facets|length }}</td></tr>
        <tr><th>Blocks</th><td>{{ flow.blocks|length }}</td></tr>
        <tr><th>Statements</th><td>{{ flow.statements|length }}</td></tr>
    </table>
</article>

{% if flow.compiled_sources %}
<p>
    <a href="/flows/{{ flow.uuid }}/source" role="button" class="outline">View AFL Source</a>
    <a href="/flows/{{ flow.uuid }}/json" role="button" class="outline">View JSON</a>
</p>
{% endif %}

<h2>Workflows ({{ workflows|length }})</h2>
<figure>
<table>
    <thead>
        <tr><th>Namespace</th><th>Workflows</th></tr>
    </thead>
    <tbody>
        {% for ns in namespace_list %}
        <tr>
            <td><a href="/flows/{{ flow.uuid }}/ns/{{ ns.prefix }}">{{ ns.name }}</a></td>
            <td>{{ ns.count }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</figure>

{% if flow.namespaces %}
<h2>Namespaces</h2>
<figure>
<table>
    <thead>
        <tr><th>Name</th><th>UUID</th></tr>
    </thead>
    <tbody>
        {% for ns in flow.namespaces %}
        <tr>
            <td><a href="/namespaces/{{ ns.name }}"><strong>{{ ns.name }}</strong></a>{% if ns.documentation %}{{ render_doc(ns.documentation) }}{% endif %}</td>
            <td class="mono">{{ ns.uuid }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</figure>
{% endif %}

{% if flow.facets %}
<h2>Facets</h2>
<figure>
<table>
    <thead>
        <tr><th>Name</th><th>Namespace ID</th><th>UUID</th></tr>
    </thead>
    <tbody>
        {% for facet in flow.facets %}
        <tr>
            <td><strong>{{ facet.name }}</strong>{% if facet.documentation %}{{ render_doc(facet.documentation) }}{% endif %}</td>
            <td class="mono">{{ facet.namespace_id }}</td>
            <td class="mono">{{ facet.uuid }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</figure>
{% endif %}

{% if runners %}
<h2>Execution History</h2>
<figure>
<table>
    <thead>
        <tr><th>Runner ID</th><th>Workflow</th><th>State</th><th>Started</th><th>Duration</th></tr>
    </thead>
    <tbody>
        {% for runner in runners %}
        <tr>
            <td><a href="/runners/{{ runner.uuid }}" class="mono">{{ runner.uuid|truncate_uuid }}</a></td>
            <td>{{ runner.workflow.name }}</td>
            <td><span class="badge badge-{{ runner.state|state_color }}">{{ runner.state }}</span></td>
            <td>{{ runner.start_time|timestamp }}</td>
            <td>{{ runner.duration }}ms</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</figure>
{% endif %}
{% endif %}
{% endblock %}
