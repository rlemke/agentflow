{% extends "base.html" %}

{% block title %}
{% if runner %}{{ runner.workflow.name }} â€” AgentFlow{% else %}Workflow Not Found{% endif %}
{% endblock %}

{% block subnav %}
{% if runner %}
<div class="container">
    <div class="subnav">
        <a href="/v2/workflows/{{ runner.uuid }}?step_tab=running"
           class="subnav-pill{% if step_tab == 'running' %} active{% endif %}">
            Running <span class="subnav-count">{{ step_counts.running }}</span>
        </a>
        <a href="/v2/workflows/{{ runner.uuid }}?step_tab=error"
           class="subnav-pill{% if step_tab == 'error' %} active{% endif %}">
            Error <span class="subnav-count">{{ step_counts.error }}</span>
        </a>
        <a href="/v2/workflows/{{ runner.uuid }}?step_tab=complete"
           class="subnav-pill{% if step_tab == 'complete' %} active{% endif %}">
            Complete <span class="subnav-count">{{ step_counts.complete }}</span>
        </a>
    </div>
</div>
{% endif %}
{% endblock %}

{% block content %}
{% if runner %}
<hgroup>
    <h1>{{ runner.workflow.name|short_workflow_name }}</h1>
    <p>
        <span class="mono">{{ runner.workflow.name }}</span>
        &mdash;
        <span class="badge badge-{{ runner.state|state_color }}">{{ runner.state }}</span>
    </p>
</hgroup>

<div class="summary-grid">
    <article class="summary-card">
        <h2 class="mono">{{ runner.uuid|truncate_uuid }}</h2>
        <p>Runner ID</p>
    </article>
    <article class="summary-card">
        <h2>{{ runner.start_time|timestamp }}</h2>
        <p>Started</p>
    </article>
    <article class="summary-card">
        <h2>{{ runner.duration|duration }}</h2>
        <p>Duration</p>
    </article>
</div>

<div class="actions" style="margin-bottom: 1rem;">
    {% if runner.state == 'running' %}
    <form method="post" action="/runners/{{ runner.uuid }}/pause" style="display:inline;">
        <button type="submit" class="secondary outline">Pause</button>
    </form>
    <form method="post" action="/runners/{{ runner.uuid }}/cancel" style="display:inline;">
        <button type="submit" class="secondary outline">Cancel</button>
    </form>
    {% elif runner.state == 'paused' %}
    <form method="post" action="/runners/{{ runner.uuid }}/resume" style="display:inline;">
        <button type="submit" class="outline">Resume</button>
    </form>
    <form method="post" action="/runners/{{ runner.uuid }}/cancel" style="display:inline;">
        <button type="submit" class="secondary outline">Cancel</button>
    </form>
    {% endif %}
    <a href="/runners/{{ runner.uuid }}" role="button" class="secondary outline">Old Detail View</a>
</div>

<h2>Steps</h2>

<div id="step-rows"
     hx-get="/v2/workflows/{{ runner.uuid }}/steps/partial?step_tab={{ step_tab }}"
     hx-trigger="every 5s"
     hx-swap="innerHTML">
    {% include "v2/workflows/_step_rows.html" %}
</div>

{% else %}
<h1>Workflow Not Found</h1>
<p>The requested runner could not be found.</p>
<a href="/v2/workflows">Back to Workflows</a>
{% endif %}
{% endblock %}
