# Docker Compose override for local Geofabrik mirror.
#
# Usage:
#   AFL_GEOFABRIK_MIRROR=/path/to/mirror \
#     docker compose -f docker-compose.yml -f docker-compose.mirror.yml up -d
#
# This override:
#   - Mounts the host mirror directory read-only at /data/osm-mirror
#   - Sets AFL_GEOFABRIK_MIRROR=/data/osm-mirror in agent containers
#   - Agents check the mirror before downloading from Geofabrik

services:
  agent-osm-geocoder:
    environment:
      - AFL_GEOFABRIK_MIRROR=/data/osm-mirror
    volumes:
      - ${AFL_GEOFABRIK_MIRROR:?Set AFL_GEOFABRIK_MIRROR to mirror directory}:/data/osm-mirror:ro

  agent-osm-geocoder-lite:
    environment:
      - AFL_GEOFABRIK_MIRROR=/data/osm-mirror
    volumes:
      - ${AFL_GEOFABRIK_MIRROR}:/data/osm-mirror:ro
