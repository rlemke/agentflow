# AgentFlow OSM Geocoder Agent (Lite)
# Basic OSM data processing: download, cache, region resolution
# No Java/GraphHopper â€” use the full image for routing graph operations
FROM python:3.12-slim

WORKDIR /app

# Install AFL with MongoDB support
COPY pyproject.toml .
RUN pip install --no-cache-dir -e ".[mongodb]" || \
    pip install --no-cache-dir lark pymongo

# Install requests for Nominatim API and Geofabrik downloads
RUN pip install --no-cache-dir requests

# HDFS support uses WebHDFS REST API via requests (already installed above)

# Optional PostGIS support (psycopg2)
ARG INSTALL_POSTGIS=false
RUN if [ "$INSTALL_POSTGIS" = "true" ]; then pip install --no-cache-dir psycopg2-binary; fi

# Copy application code
COPY afl/ ./afl/
COPY examples/osm-geocoder/ ./examples/osm-geocoder/

ENV PYTHONPATH=/app
WORKDIR /app/examples/osm-geocoder

CMD ["python", "agent.py"]
